;frame Rango
frame Rango
    slot name
        type string
        cardinality 1
        required true
    slot valorEsperado
        type float
        cardinality 1
        required true
        daemon if-modified actualizarMinimoMaximo
            def actualizarMinimoMaximo(self):
                self.minimo = self.valorEsperado - self.tolerancia
                self.maximo = self.valorEsperado + self.tolerancia
    slot tolerancia
        type float
        cardinality 1
        required true
        daemon if-modified actualizarMinimoMaximo
            def actualizarMinimoMaximo(self):
                self.minimo = self.valorEsperado - self.tolerancia
                self.maximo = self.valorEsperado + self.tolerancia
    slot minimo
        type float
        cardinality 1
        required true
        daemon if-needed getMinimo
            def getMinimo(self):
                self.minimo = self.valorEsperado - self.tolerancia
    slot maximo
        type float
        cardinality 1
        required true
        daemon if-needed getMaximo
            def getMaximo(self):
                self.maximo = self.valorEsperado + self.tolerancia

frame Temp80
    instanceof Rango
    slot name
        value "Rango de temperatura para proceso térmico"
    slot valorEsperado
        value 80.0
    slot tolerancia
        value 3.0

frame Temp30
    instanceof Rango
    slot name
        value "Rango de temperatura para enfriamiento"
    slot valorEsperado
        value 30.0
    slot tolerancia
        value 3.0


;frame Etapa e instancias
frame Etapa
    slot name
        type string
        default "Etapa default"
        cardinality 1
        required true
    slot precedeA
        type Etapa
        default none
        cardinality 0..1
        required false
    slot configuracionTemperatura
        type Rango
        cardinality 1
        required true

frame Enfriamiento
    instanceof Etapa
    slot name
        value "Enfriamiento"
    slot configuracionTemperatura
        value Temp30

frame ProcesoTermico
    instanceof Etapa
    slot name
        value "Proceso Térmico"
    slot precedeA
        value Enfriamiento
    slot configuracionTemperatura
        value Temp80

;frame Temperatura
frame Temperatura
    slot name
        type string
        default "Temperatura Interna"
        cardinality 1
        required true
    slot valor
        type float
        cardinality 1
        required true
        daemon if-added actualizarEstadoTemperatura
            def actualizarEstadoTemperatura(self, etapaActual):
                if self.valor < etapaActual.configuracionTemperatura.minimo:
                    self.estado = "TemperaturaBaja"
                elif self.valor > etapaActual.configuracionTemperatura.maximo:
                    self.estado = "TemperaturaAlta"
                else:
                    self.estado = "TemperaturaEnRango"
    slot ts 
        type datetime
        default datetime.now()
        cardinality 1
        required true
    slot unidad
        type string
        default "Celsius"
        cardinality 1
        required true
    slot estado
        type Enum["TemperaturaBaja", "TemperaturaAlta", "TemperaturaEnRango"]
        default "TemperaturaEnRango"
        cardinality 1
        required true


; frame Corrida
frame Corrida
    slot name
        type string
        cardinality 1
        required true
    slot id
        cardinality 1
        required true
    slot fechaInicio
        type date
        default datetime.now()
        cardinality 0..1
        required true
    slot etapaActual
        type Etapa
        default ProcesoTermico
        cardinality 1
        required true
        daemon if-modified actualizarEstadoTemperatura
            def actualizarEstadoTemperatura(self):
                if self.temperaturaInterna.valor < self.etapaActual.configuracionTemperatura.minimo:
                    self.temperaturaInterna.estado = "TemperaturaBaja"
                elif self.temperaturaInterna.valor > self.etapaActual.configuracionTemperatura.maximo:
                    self.temperaturaInterna.estado = "TemperaturaAlta"
                else:
                    self.temperaturaInterna.estado = "TemperaturaEnRango"
    slot fechaFin
        type date
        default none
        cardinality 0..1
        required false
    slot temperaturaInterna
        type Temperatura
        cardinality 1
        required true